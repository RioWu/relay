# 技术架构

- #### 前端使用 `React.js`框架，后台使用`PHP`语言和`ElasticSearh`搜索引擎

- #### 相关接口

  ## connect

  功能：用于连接数据库

  - 数据库结构

    ```mysql
    DROP TABLE IF EXISTS `user`;
    CREATE TABLE IF NOT EXISTS `user` (
      `id` int(11) NOT NULL AUTO_INCREMENT,
      `username` varchar(256) NOT NULL,
      `password` varchar(256) NOT NULL,
      `isadmin` tinyint(1) NOT NULL,
      PRIMARY KEY (`id`)
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8;
    COMMIT;
    ```

  ## login

  功能：用于实现与登陆相关的用户认证、会话控制、权限认证等功能。

  - userInfo

    - 功能：用于判断用户是否已经登陆，如果已经登陆，通过SESSION识别用户权限

    - HTTP METHOD: GET

    - request:

      - null

    - return:

      ```json
      {
          "islogin":int,	//1表示用户已登陆，直接跳转到登陆成功页面，0表示未登录，跳转到登陆页面
          "isadmin":int	//0表示不是管理员，1表示是管理员，跳转到管理员页面
      }
      ```

  - login

    - 功能：用于实现用户名和密码的认证以及管理员身份判定。

    - HTTP METHOD:POST

    - request: 

      ```json
      {
       	"username":string,
          "password":string
      }
      ```

    - return:

      ```json
      {
          "success":int,				//1表示认证成功，0表示认证失败
          "errorcode":int,			
          "errormessage":string,		
         	"isadmin":int				//1表示是管理员，0表示不是管理员
      }
      ```

      | errorcode                  | errormessage     | meaning                            |
      | -------------------------- | ---------------- | ---------------------------------- |
      | 200                        | null             | 登陆成功                           |
      | 403                        | 用户名或密码错误 | 登陆失败                           |
      | PDOException $e->getCode() | $e->getMessage() | 数据库连接或者操作时可能出现的错误 |

  - logout

    - 功能：用于注销用户（注销之后将不会再有免登陆的功能)

    - HTTP METHOD：GET

    - request:null

    - return:

      ```json
      {
          "success":1,
          "errorcode":200,
          "errormessage":""
      }
      ```

  ## admin

  功能：用于管理员实现增加用户、

  删除用户、更改密码等功能。

  - userList

    - 功能：返回所有的用户信息

    - HTTP METHOD:GET

    - request:null

    - return:

      ```json
      {
          "success":int 						//1表示操作成功，0表示操作失败
      	[
          	{
              	id:int,						//userid,是用户在数据库里的唯一标识
              	username:string,			//用户名
              	isadmin						//是否是管理员
          	},
          	{
              	...
          	},
          	...
      	]
      ```

      |         errorcode          |    errormessage    |              meaning               |
      | :------------------------: | :----------------: | :--------------------------------: |
      |            200             |        null        |              操作成功              |
      | PDOException $e->getCode() |  $e->getMessage()  | 数据库连接或者操作时可能出现的错误 |
      |            403             | 没有权限登陆此界面 |       非管理员用户请求此接口       |

  - addUser

    - 功能：用于添加新用户

    - HTTP METHOD：POST

    - request:

      ```json
      {
          "username":string,
          "password":string，
          "isadmin":int  				//1表示是管理员，0表示不是管理员
      }
      ```

    - return:

      ```json
      {
          "success":int,				//1表示添加成功，0表示添加失败
          "errorcode":int,			
          "errormessage":string,		
      }
      ```

      |         errorcode          |   errormessage   |              meaning               |
      | :------------------------: | :--------------: | :--------------------------------: |
      |            200             |       null       |              操作成功              |
      | PDOException $e->getCode() | $e->getMessage() | 数据库连接或者操作时可能出现的错误 |

  - deleteUser

    - 功能：用于删除用户

    - HTTP METHOD:POST

    - request:

      ```json
      {
          "userid":int
      }
      ```

    - return:

      ```json
      {
          "success":int,
          "errorcode":int,
          "errormessage":string
      }
      ```

      |         errorcode          |   errormessage   |              meaning               |
      | :------------------------: | :--------------: | :--------------------------------: |
      |            200             |       null       |              操作成功              |
      | PDOException $e->getCode() | $e->getMessage() | 数据库连接或者操作时可能出现的错误 |

  - changepassword

    - 功能：用于修改密码

    - HTTP METHOD:POST

    - request:

      ```json
      {
          "userid":int,
          "password":string
      }
      ```

    - return:

      ```json
      {
          "success":int,
          "errorcode":int,
          "errormessage":string
      }
      ```

      |         errorcode          |   errormessage   |              meaning               |
      | :------------------------: | :--------------: | :--------------------------------: |
      |            200             |       null       |              操作成功              |
      | PDOException $e->getCode() | $e->getMessage() | 数据库连接或者操作时可能出现的错误 |

- #### 上线服务器域名：

  - `http://121.48.165.39`

- #### 项目部署：

  - `NGINX` `PHP` `MYSQL`
  - `ElasticSearch`
  - `NPM` `REACT`

- #### 项目优化方向：

  - 精简代码结构
  - 优化项目结构，增加响应速度